%----------------------------------------------------------------------------
\chapter{Experimental results}\label{chap:Tests}
%----------------------------------------------------------------------------
In the following chapter the results of the system tests will be discussed. 
Performance and precision criteria 
%----------------------------------------------------------------------------
\section{Evaluation results}
%----------------------------------------------------------------------------
\subsection{Test videos}


\subsection{Results}
\subsubsection{Initial setting}
- minSize: 250
- lanes: defined for most videos

\subsubsection{The minimal size of blobs redefined}
- minSize: 200
- lanes: defined for most videos

\subsubsection{No lanes defined}
- minSize: 200
- lanes: no lanes

\subsubsection{Split size added}
- minSize: 100
- splitMinSize : 100

\subsection{Common errors and solutions}
\subsubsection{False positives}
\subsubsection{False negatives}
\subsubsection{Misclassification errors}

%----------------------------------------------------------------------------
\section{Calibration correction}\label{chap:cal_corr}
%----------------------------------------------------------------------------
Due to perspective distortion, vehicles, that in effect have the same sizes differ in length on the Raw Frames.
Since vehicle lengths are the basis of classification, perspective distortion is eliminated using a quadrangle, called the calibration rectangle, that is defined by the user.

The calibration rectangle is hand-drawn on a frame in the Project Configurator GUI (section \ref{chap:calibration}.) as part of the calibration process.
The position and the sides' lengths are estimated with the help of any occurring road lanes, or simply based on naked eye examination.
On this wise, due to the inaccuracy of human perception, the location and size of the calibration rectangle are significantly uncertain.
Empirical analysis shows that errors are actually present in many hand-calibrated videos.

To avoid manual calibration, some traffic surveillance systems automatize this process.
However in heterogeneous environment, it is a highly complex problem, and is not implemented in the current version of the Traffic Sensor system.

To correct the existent settings, the extent of the miscalibration is evaluated examining the length of the vehicles close to and far from the camera.
This way the calibration rectangle is redefined for later use during the evaluation phase of the processing.

\subsection{The miscalibration problem}
\subsubsection{Perspective compensation method}
The calibration rectangle is constructed by defining its four edges from the upper left corner, to the lower left one in order.
The edges must correspond to a square's in the 3D world, that due to the perspective transformation, show as a general rectangle on the image plane.
On most frames, lane markings are used for this purpose.

The transform projects the four vertices back into a square, along with the entire pixel grid of the image using a transformation map to speed up the process.
For defining the transform and constructing the map two universal OpenCV methods were used\cite{PersTrans, WrapPers}.

In the result images -- the Original Frame -- the vehicle lengths are independent of the position in the image plane. 
This opens the possibility of correct calibration.

The calibration rectangle's sides are also used to define a scaling factor between the 3d world and the image plane.
This can convert all lengths in the image to a metric scale.

\subsubsection{Miscalibrated streams}
- if the edges of the rectangle do not fit a perfect square in reality (valosag)
- the vehicles on the compensated frames are not the same length
- in most cases their lengths still decrease as (t√°volodva) from the camera
- easily (felismerheto) (jelenseg): the int the farest?? road lane cares are classified as bicycles

\subsection{Solutions}
\begin{enumerate}
	\item  \textbf{Estimate decrease}
	\item  \textbf{Calculate proper size ratios}
	\item  \textbf{Redraw calibration rectangle}
\end{enumerate}
- quantify the decrease of the lengths
- based on the correct lengths, redraw the calibration rect

\subsection{Calibration correction results}

%----------------------------------------------------------------------------
\section{Speed testing}
%----------------------------------------------------------------------------
- Speed criteria to meet:
	- minimum speed \SI{25}{frame/s}
	- loosing frames and thus vehicles
	- the optimum is higher, \SI{30}{frame/s}
	- important to be higher for the integration of new functions, processing steps, or extending existing ones
	- e.g. shadow-detection feature, or a more sophisticated classifier

\subsection{Results}
