%----------------------------------------------------------------------------
\appendix
%----------------------------------------------------------------------------
\chapter*{Appendices}\addcontentsline{toc}{chapter}{Appendices}\label{chap:Appendices}
\setcounter{chapter}{1}  % a fofejezet-szamlalo az angol ABC 6. betuje (F) lesz
\setcounter{equation}{0} 
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{lstlisting}{section}
%\numberwithin{tabular}{section}

%----------------------------------------------------------------------------
\section{Advertisement application}
%----------------------------------------------------------------------------
The advertisement application is an alternative utilization of the Traffic Sensor's functionality, availing of that the Sensor is able to detect and count any moving objects in its environment.

The goal of the application is to estimate the number of people present on the corridor of the \viktanszek, where the Sensor will be deployed.
The Traffic Sensor system will be connected to a screen with a web interface, that shows miscellaneous advertisements.

Advertisers will be able to buy time-intervals for their advertisements for different prices.
The intervals' prices are assessed based on the count of people present at that time.

The Traffic Sensor is already fit for the task, however the following settings were modified for the changed situation.
\begin{enumerate}
	\item The camera angle is horizontal, thus the Tripwire is set to vertical.
	
	\item Since the bypassing people are close to the camera, they are not subject to significant  perspective distortion, and there is no need for perspective compensation.
	
	\item The other consequence of the closeness of the camera is that moving objects fill most of the frame, and to detect them, only a rather small Tripwire is necessary, approximately a \SI{20}{pixel} long section.
	An advantage resulting from this is the low computation time.
	
	\item The minimal size of blobs is adjusted to the size of the detected objects empirically.
	
	\item There is no need for classification, since it is highly likely, that on the corridor only people are present.
\end{enumerate}

Although the Advertisement Application is still in pilot phase, and is not fully deployed yet, some example images of the configuration process are seen in figures \ref{fig:adv_app_config}., \ref{fig:adv_app_full_orig}., \ref{fig:adv_app_counting}.

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.5\textwidth]{ad_app_config.png}
	
	\caption{The GUI of the Project Configurator, showing the initial configuration of the Advertisement Application. Here, the Tripwire crosses the whole frame, although later it is decreased, since the application can count people using a much smaller portion of the line.  \label{fig:adv_app_config}}
\end{figure}

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.6\textwidth]{orig_full.png}
	
	\caption{Part of the Original Timeline Image showing a series of people walking in front of the camera. Since the person occupies the whole height of the image, for detection only a smaller section of the image is enough, as seen on figure \ref{fig:adv_app_counting}.\label{fig:adv_app_full_orig}}
\end{figure}

\begin{figure}[!h]
	\centering
	\begin{subfigure}[t]{0.6\textwidth}
	\includegraphics[width=\textwidth]{original_section.png}
	\subcaption{Part of the Original Timeline Image.}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.6\textwidth}
		\includegraphics[width=\textwidth]{mog2_section.png}
		\subcaption{Part of the MOG2 Timeline Image.}
	\end{subfigure}

	\caption{Timeline Images of the Advertisement Application. The MOG2 image captures the moving object correctly each time, but also some noise due to light changes.\label{fig:adv_app_counting}}
\end{figure}

%----------------------------------------------------------------------------
\clearpage\section{VideoMixer application}
%----------------------------------------------------------------------------
The VideoMixer application was created as a side-project for the customers of the Traffic Sensor.

The software is responsible for the visualization of multiple video streams at the same time for demonstration purposes.

The videos can either be recorded from a camera or read from a file.
The user can control, which videos are seen at a certain time, that are blended by the application on top of each other.
The speed of the playing and the looping of the videos can be set as well.

\begin{figure}[!h]
	\centering
	\includegraphics[width=0.5\textwidth]{vm_menu.png}
	
	\caption{The menu of the VideoMixer. Whenever a key is pressed, it is displayed, as well as the possible control options. \label{fig:video_mixer_menu}}
\end{figure}

The settings (e.g the name and type of the input videos, the controlling keys and the whether the videos are looped) are defined in a configuration file, similarly to the Traffic Sensor's (seen in code-listing \ref{lst:config_vm}).

The application can be utilized as a demonstration of the Traffic Sensor's operation as well, some example frames are figures \ref{fig:video_mixer_frames}., \ref{fig:video_mixer_menu}..

\begin{lstlisting}[frame=single,float=!ht,caption={Part of a configuration file for the VideoMixer application. The file sets parameters for the main input video (section [mainVideoInput]), and the overlay videos (section [overlayVideos]), that are blended on top. The file defines whether the video is read from a camera or a file, whether some parts of the background are removed, and other adjustments, like the comment displayed on the screen, when a video starts playing.},label=lst:config_vm]
{
[mainVideoInput]
cameraInput = false
cameraIndex = 0
filename = orig.avi
loop = true
removeBackgroundColor = 0x00ff00

[overlayVideos]
filename_0 = mog2.avi
gpioNum_0 = 0
overlayRatio_0 = 0.4
comment_0 = playing file 1
displayCommentOnScreen_0 = false
removeBackgroundColor_0 =  0x00ff00
loop_0 = true
filename_1 = speed.avi
...
\end{lstlisting}

\begin{figure}[!h]
	\centering
	\begin{subfigure}[t]{0.6\textwidth}
		\includegraphics[width=\textwidth]{orig_mog22.png}
		\subcaption{The overlay video captures MOG2 Frames and the building process of a MOG2 Timeline Image.}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.6\textwidth}
		\includegraphics[width=\textwidth]{orig_result.png}
		\subcaption{The overlay video captures a Result Timeline image, that shows the detected vehicles with different colors projected on top of the main video. The Result Timeline also displays vehicle parameters, such as size and type. Blending this videos together, both correct and faulty detections can be analysed.}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.6\textwidth}
		\includegraphics[width=\textwidth]{orig_speeds.png}
		\subcaption{The blended video is a Speed Timeline. The direction of each detected vehicle can be read by the colors of the Speed Timeline (with red the vehicles moving from the right to the left are marked, and the ones heading in the other direction are colored with blue). }
	\end{subfigure}

	\caption{Frames of the VideoMixer application. The overlay video is blended on top of the main video, that consists of an Original Frame and an Original Timeline recorded using the Traffic Sensor. Overlay videos are other Timeline Images, MOG2, Speed and Result.\label{fig:video_mixer_frames}}
\end{figure}

%----------------------------------------------------------------------------
\clearpage\section{Some examples of the output Timeline Images}\label{app:TIs}
%----------------------------------------------------------------------------
This appendix presents some test results in the form of output Timeline Images, focusing on remarkable points and interesting details.

\centering
\begin{figure}[h!]
	\centering
	\includegraphics[width=\textwidth]{GoldA1.png}
	\caption[Some output Timelines of the GoldA1 test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, MOG2 Timeline Image, Size Timeline Image, Speed Timeline Image and Evaluation Result Timeline Image respectively. On night-time videos a prevalent error cause are headlights of the vehicles, that are reflected back by the road, causing false alarms (right side of the image). Misclassification cases are commonly caused by headlight blobs fusing with the following vehicle increasing its size (seen on the Size Timeline). On the Speed Timeline the directions of the lanes are observable based on the colours of the vehicles. \label{fig:GoldA1}}
\end{figure}

\centering
\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\textwidth]{GoldB12.png}
	\caption[Some output Timelines of the GoldB1 test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, MOG2 Timeline Image, Motionless Timeline Image, Size Timeline Image, Speed Timeline Image and Evaluation Result Timeline Image respectively. The following common error cases are seen in the Evaluation Result Timeline Image. Small blobs of motorcycles are filtered out (in the middle crossed with red) causing false negatives. Some stopping vehicles add noise to the detection when missed by the fusing algorithm (false negatives and noise on the left side of the image). The splitting mechanism erroneously cuts apart vehicles, that have a peculiar shape (in the middle and in the right). The Parameter Timelines were calculated without lanes. Intensities on the Size Timeline show the length of vehicles, and one can notice the directions of road lanes using the colours of the Speed Timeline. \label{fig:GoldB1}}
\end{figure}

\clearpage
\centering
\begin{sidewaysfigure}[h!]
	\centering
	\captionsetup{width=0.9\textwidth,aboveskip=10pt}
	\includegraphics[width=\textwidth]{ErE5.png}
	\caption[Some output Timelines of the ErE5 test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, MOG2 Timeline Image, Size Timeline Image, Following Distance Timeline Image, Speed Timeline Image and Result Timeline Image respectively. The video was recorded at the IBikeBudapest cyclist demonstration, road users are almost exclusively cyclists. Comparing the Size and the Following Distance Timeline, it is observable, that following distance and length are calculated in alternate times, whether the Tripwire is empty (following distances) or occupied by a vehicle (length). An interesting point of the results is the car in red on the top part of the Speed Timeline, heading in the opposite direction as the cyclists. Different colour dots inside the vehicles in the Speed Timeline are caused by noises, when the change of the vehicle's size falsifies the speed calculation (further details in chapter \ref{chap:parameter_evaluation}.). \label{fig:ErE5}}
\end{sidewaysfigure}

\centering
\begin{sidewaysfigure}[h!]
	\centering
	\captionsetup{width=0.9\textwidth,aboveskip=10pt}
	\includegraphics[width=\textwidth]{Fovam_C.png}
	\caption[Some output Timelines of the Fovam\_C test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, MOG2 Timeline Image and Result Timeline Image respectively. The video was recorded at sundown, and captures only a few cars. Although the environmental light frequently changes (the lilac section on the left), the count of false detections is low. Fused cars in the middle are split appropriately. However the stopping pedestrian (top right corner) is ignored, and the other two pedestrians are falsely split based on their shapes.}
\end{sidewaysfigure}

\centering
\begin{sidewaysfigure}[h!]
	\centering
	\includegraphics[width=\textwidth]{ErC1.png}
	\caption[Some output Timelines of the ErC1 test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, Result Timeline Image and Evaluation Result Timeline Image respectively. The video captures a stopping tram, a handful of cars and pedestrians. The tram's slow movement is still a challenge to the fusing algorithm, thus causes some noise.}%{ErC kódú videó futtatási eredménye. Fentről lefelé a képek rendre a következők. entről lefelé a képek rendre a következők. Eredeti videóból képzett TK. MOG2 TK. A kiértékelés eredménye. \\
		%A videón egy megálló villamos, illetve a mellette haladó gyalogosok és autók láthatók. A rendszer jól összeilleszti a megálló villamos blobját, de helytelenül a jobb alsó sarokban található blobokat (hosszú téglalap), amely csak a a háttér folytonossága miatt tűnik a rendszernek megálló autónak.}
\end{sidewaysfigure}

\centering
\begin{sidewaysfigure}[h!]
	\centering
	\includegraphics[width=\textwidth]{SasA1.png}
	\caption[Some output Timelines of the SasA1 test video]{The figures (from the top to the bottom) are as follows: Original Timeline Image, MOG2 Timeline Image, Speed Timeline Image and Evaluation Result Timeline Image respectively. The evaluation results of this video are good. Most fused vehicles are correctly split, and stopping vehicles' blobs are mostly reattached as well. Due to shaky camera, that causes the background to change, a false alarm is detected (top, middle part). The Speed Timeline is calculated only in the centre of road lanes displaying fewer values than the Parameter Timelines in figures \ref{fig:ErE5}., \ref{fig:GoldA1}., \ref{fig:GoldB1}}
\end{sidewaysfigure}


